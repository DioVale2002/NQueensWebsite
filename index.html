<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>N-Queens Problem Simulation</title>
</head>

<body>
  <h1>N-Queens Problem Text Simulator</h1>

  <div class="controls">
    <label for="boardSize">Board Size (N):</label>
    <input type="number" id="boardSize" min="1" max="12" value="4">
    <button id="solveButton">Solve</button>
  </div>
NQueenSimulation
  
  <div class="solution-count-div" id="solution-count-div">
    <h1 class="solution-count" id="solution-count"></h1>
  </div>
  <div class="board" id="chessboard"></div>
  <div class="solution-number-div" id="solution-number-div">
    <h1 class="solution-number" id="solution-number"></h1>
    <button class="btns" id="showTrackLog">Show TrackLog</button>
    <button class="btns" id="prevSolution"><img src="prev_button.png" alt="prevButton" class="btnImg"></button>
    <button class="btns" id="nextSolution"><img src="next_button.png" alt="nextButton" class="btnImg"></button>
  </div>

  <div id="trackLogModal" class="modal">
    <div class="modal-content">
      <span id="closeModalBtn" class="close">&times;</span>
      <h2>Trace Log</h2>
      <p id="traceParagraph"></p>
    </div>
  </div>


  <div id="output">Solution will appear here...</div>
main

  <div class="explanation">
    <h3>About the N-Queens Problem:</h3>
    <p>The N-Queens puzzle is the problem of placing N chess queens on an N√óN chessboard so that no two queens threaten
      each other. This means no two queens can share the same row, column, or diagonal.</p>
    <p>In the output:</p>
    <ul>
      <li>'Q' represents a queen</li>
      <li>'.' represents an empty cell</li>
    </ul>
  </div>

  <script>
NQueenSimulation
    const traceLogModal = document.getElementById('trackLogModal');
    const openTraceLog = document.getElementById('showTrackLog');
    const closeTraceLog = document.getElementById('closeModalBtn');
    const boardDiv = document.getElementById('chessboard');
    const solutionCurrentNumberDiv = document.getElementById('solution-number-div');
    const prevButton = document.getElementById('prevSolution');
    const nextButton = document.getElementById('nextSolution');
    const solutionCountDiv = document.getElementById('solution-count-div');

    let solutions = [];
    let traceLog = [];
    let solutionCount;
    let solutionTraceCounter = 0;
main

    // to solve n-queens problem
    document.getElementById('solveButton').addEventListener('click', () => {
      const n = parseInt(document.getElementById('boardSize').value);
      if (n < 1 || n > 12) {
        alert('Please enter a board size between 1 and 12');
        return;
      }
NQueenSimulation
      
      solutionCount = 0;
      [solutions, traceLog] = solveNQueens(n);
      displayBoard(solutionCount);
    });

    // to display previous solution
    document.getElementById('prevSolution').addEventListener('click', () => {
      if (solutions.length > 0 || (solutionCount + 1) >= solutions.length) {
        solutionCount--;
        displayBoard(solutionCount);
      }
    });
    
    //to display next solution
    document.getElementById('nextSolution').addEventListener('click', () => {
      if (solutions.length > 0 || (solutionCount + 1) < solutions.length) {
        solutionCount++;
        displayBoard(solutionCount);
      }
    });

    // Open trackLog
    openTraceLog.addEventListener('click', () => {
      traceLogModal.style.display = 'block';
      const traceParagraph = document.getElementById('traceParagraph');

      // Clear previous content
      traceParagraph.textContent = '';
      traceParagraph.textContent = traceLog.join('');
    });

    // Close trackLog
    closeTraceLog.addEventListener('click', () => {
      traceLogModal.style.display = 'none';
    });

    // Close tracklog when clicking outside the content
    window.addEventListener('click', (event) => {
      if (event.target === traceLogModal) {
        traceLogModal.style.display = 'none';
      }
    });


      const { solutions, traceLog } = solveNQueens(n);
      displaySolutions(solutions, traceLog);
    });
 main

    function solveNQueens(n) {
      const solutions = [];
      const board = Array(n).fill().map(() => Array(n).fill('.'));
      let traceLog = [];

      function isSafe(row, col) {
        // Check row
        for (let i = 0; i < col; i++) {
          if (board[row][i] === 'Q') return false;
        }

        // Check upper diagonal
        for (let i = row, j = col; i >= 0 && j >= 0; i--, j--) {
          if (board[i][j] === 'Q') return false;
        }

        // Check lower diagonal
        for (let i = row, j = col; i < n && j >= 0; i++, j--) {
          if (board[i][j] === 'Q') return false;
        }

        return true;
      }
 NQueenSimulation
      


main
      function backtrack(col, depth = 0) {
        if (col === n) {
          // Found a solution, add it
          const solution = board.map(row => row.join(''));
          solutions.push(solution);
NQueenSimulation
          traceLog.push(`${'  '.repeat(depth)}‚úîÔ∏è Solution ${solutionTraceCounter+1} found!\n\n`);
          solutionTraceCounter++;

          traceLog.push(`${'  '.repeat(depth)}‚úîÔ∏è solution found:\n${solution.join('\n')}\n`);
main
          return;
        }

        for (let row = 0; row < n; row++) {
          if (isSafe(row, col)) {
            board[row][col] = 'Q';
 NQueenSimulation
            traceLog.push(`${'  '.repeat(depth)}‚úÖ Placed Q at (${row}, ${col})\n`);
            backtrack(col + 1);
            board[row][col] = '.'; // Backtrack
            traceLog.push(`${'  '.repeat(depth)}‚Ü©Ô∏è Backtracked from (${row}, ${col})\n`);
          } else {
            traceLog.push(`${'  '.repeat(depth)}‚ùå Cannot place Q at (${row}, ${col})\n`);
          }
        }
      }
      backtrack(0);
      return [solutions, traceLog];
    }

    function displayBoard(solutionCount) {
      if(solutions == null || solutions.length === 0) {
        hideElements();
        solutionCountDiv.style.display = 'block';
        document.getElementById('solution-count').innerText  = "No solutions found!";
        return; 
      }

      if(solutions.length === 1) {
        hideButtons();
      } 

      showElements();
      document.getElementById('solution-count').innerText = `${solutions.length} Solution${solutions.length > 1 ? 's' : ''} Found!`;

      if((solutionCount+1) === solutions.length){ //hide next button
        nextButton.style.visibility = 'hidden';
      }

            traceLog.push(`${'  '.repeat(depth)}‚úÖ Placed Q at (${row}, ${col})`);
            backtrack(col + 1);
            board[row][col] = '.'; // Backtrack
            traceLog.push(`${'  '.repeat(depth)}‚Ü©Ô∏è Backtracked from (${row}, ${col})`);
          } else {
            traceLog.push(`${'  '.repeat(depth)}‚ùå Cannot place Q at (${row}, ${col})`);
          }
        }
      }

      backtrack(0);
      return { solutions, traceLog };
    }

    function displaySolutions(solutions, traceLog) {
      const outputDiv = document.getElementById('output');

      let output = '';
 main

      if (solutions.length === 0) {
        output += "No solutions found!\n\n";
        outputDiv.textContent = output;
        return;
      } else {
        output += `Found ${solutions.length} solution${solutions.length > 1 ? 's' : ''}:\n\n`;
      }

      // Display first solution fully
      output += "Solution 1:\n";
      for (let i = 0; i < solutions[0].length; i++) {
        output += solutions[0][i] + "\n";
      }

      // If there are more solutions, show a sample
      if (solutions.length > 1) {
        output += "\nSolution 2:\n";
        for (let i = 0; i < solutions[1].length; i++) {
          output += solutions[1][i] + "\n";
        }

        if (solutions.length > 2) {
          output += `\n...and ${solutions.length - 2} more solution${solutions.length > 3 ? 's' : ''}.`;
        }
      }

      output += `\n\nüìú Recursive Call Trace:\n` + traceLog.join('\n');
      outputDiv.textContent = output;
    }

    function showElements(){
      solutionCountDiv.style.display = 'block';
      openTraceLog.style.display = 'block';
      boardDiv.style.display = 'grid';
      solutionCurrentNumberDiv.style.display = 'flex';
      prevButton.style.visibility = 'visible';
      prevButton.style.display = 'block';
      nextButton.style.visibility = 'visible';
      nextButton.style.display = 'block';
    }

    function hideElements(){
      boardDiv.style.display = 'none';
      prevButton.style.display = 'none';
      nextButton.style.display = 'none';
      openTraceLog.style.display = 'none';
      solutionCurrentNumberDiv.style.display = 'none';
    }

    function hideButtons(){
      prevButton.style.display = 'none';
      nextButton.style.display = 'none';
    }
  </script>
</body>

</html>